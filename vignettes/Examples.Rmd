---
title: "Examples"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Examples}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE
)
```

```{r setup, echo=FALSE}
library(ribbon)
library(knitr)
library(ggplot2)
library(sf)
library(tidyverse)
library(grid)
library(viridis)
library(gridExtra)
library(ozmaps)
library(ggthemes)


```
  
### Overview

ribbon provides ggplot2 extension to produce glyph plots with `geom_glyph_ribbon()` and 
`geom_glyph_segment()`.

These functions create a ribbon geometry designed to display glyphs
based on the combination of `x_major` and `y_major`. For each `x_minor`
value, `geom_glyph_ribbon()` displays a y interval defined by
`ymin_minor` and `ymax_minor`. 

Let's compare `geom_glyph_ribbon()` amd `geom_glyph_segment()`:

```{r}

vic_temp <- aus_temp |>
  filter(id %in% c("ASN00026021", "ASN00085291", "ASN00084143"))

p1 <- vic_temp |>
   ggplot(aes(x_major = long, y_major = lat,
              x_minor = month, ymin_minor = tmin, ymax_minor = tmax)) +
  geom_sf(data = abs_ste |> filter(NAME == "Victoria"),
         color = grey(0.7), fill = NA, inherit.aes = FALSE)  +
  add_glyph_boxes() +
  add_ref_lines() +
  geom_glyph_ribbon() +
  theme_map() +
  labs(title = "geom_glyph_ribbon()") +
  theme(plot.title = element_text(hjust = 0.5),
        panel.background = element_rect(fill = "white", color = NA),
        plot.background = element_rect(fill = "white", color = NA))

p2 <- vic_temp |>
   ggplot(aes(x_major = long, y_major = lat,
              x_minor = month, y_minor = tmin, yend_minor = tmax)) +
  geom_sf(data = abs_ste |> filter(NAME == "Victoria"),
          color = grey(0.7), fill = NA, inherit.aes = FALSE)  +
   add_glyph_boxes() +
   add_ref_lines() +
  geom_glyph_segment() +
  theme_map() +
  labs(title = "geom_glyph_segment()") +
  theme(plot.title = element_text(hjust = 0.5),
        panel.background = element_rect(fill = "white", color = NA),
        plot.background = element_rect(fill = "white", color = NA))

# Using gridExtra and grid packages to add neatline to the plot
grid.arrange(p1, p2, ncol = 2) 

```

### Installation

```{r, eval=FALSE}
# Download the development version from GitHub:
devtools::install_github("maliny12/ribbon")
```

### Options

Options allow you to modify how functions behave by altering parameters to meet specific needs. All of which are global options that affect all glyphs.

|Option          | Default      | Description
|--------------- | ------------ | ------------------------------------------------
| `x_scale`         | `"identity"`         | This function scales each set of minor values within a grid cell for the x-dimension.
|`y_scale`      | `"identity"`          | This function scales each set of minor values within a grid cell for the y-dimension.
|`width`         | `0.1`          |  Specifies the width of the glyph.
|`height`     | `0.1`     | Specifies the height of the glyph.
|`global_rescale`      | `TRUE`        | Determines whether rescaling is performed globally across all glyphs or individually for each glyph.

### Aesthetics

Aesthetics are parameters that you can map to your data using geom_glyph_ribbon(mapping = aes(...)).

`ribbon` provides the same aesthetics for geom_glyph_ribbon and geom_glyph_segment() as are available in geom_ribbon() or geom_segment(), but it also introduces additional unique options.

|Option          | Default      | Description
|--------------- | ------------ | ------------------------------------------------
| `colour`         | `"grey50"`         | Color for line segments and borders.
|`linewidth`      | `0.5`          | Width of the line for borders.
|`linetype`         | `1`          |  Style of the line for borders.
|`fill`     | `"grey40"`     | Color of the interior area of the geometries.
|`alpha`      | `1`        | Transparency level of the glyphs. 


### Examples
#### GeomGlyphRibbon
##### Comparison between global rescale and local rescale

This example compares the effects of global and local rescaling using the geom_glyph_ribbon() function.

- Local Rescale: With global_rescale = FALSE, ribbon widths are based on the local temperature range within each region, highlighting regional differences.

- Global Rescale: With global_rescale = TRUE, ribbon widths are based on the local temperature range within each region, highlighting regional differences.

The comparison shows how rescaling choices impact the visualization of temperature data on the map.



```{r}

p1 <- aus_temp |>
   ggplot(aes(x_major = long, y_major = lat,
              x_minor = month, ymin_minor = tmin, ymax_minor = tmax)) +
  geom_sf(data = abs_ste, color = grey(0.7), fill = NA,
          inherit.aes = FALSE)  +
  add_glyph_boxes(color = "dodgerblue4") +
  add_ref_lines(color = "dodgerblue4") +
  geom_glyph_ribbon(global_rescale = FALSE, color = "dodgerblue4", fill = "dodgerblue4") +
  theme_map() +
  coord_sf(xlim = c(110,155)) +
  labs(title = "Local Rescale") +
  theme(plot.title = element_text(hjust = 0.5),
        panel.background = element_rect(fill = "white", color = NA),
        plot.background = element_rect(fill = "white", color = NA))

p2 <- aus_temp |>
   ggplot(aes(x_major = long, y_major = lat,
              x_minor = month, ymin_minor = tmin, ymax_minor = tmax)) +
  geom_sf(data = abs_ste, color = grey(0.7), fill = NA,
          inherit.aes = FALSE)  +
   add_glyph_boxes(color = "dodgerblue4") +
   add_ref_lines(color = "dodgerblue4") +
  geom_glyph_ribbon(global_rescale = TRUE, color = "dodgerblue4", fill = "dodgerblue4") +
  theme_map() +
  coord_sf(xlim = c(110,155)) +
  labs(title = "Global Rescale") +
  theme(plot.title = element_text(hjust = 0.5),
        panel.background = element_rect(fill = "white", color = NA),
        plot.background = element_rect(fill = "white", color = NA))

# Using gridExtra and grid packages to add neatline to the plot
grid.arrange(p1, p2, ncol = 2) 
grid.rect(
    width = 0.98,
    height = 0.98,
    gp = grid::gpar(
      lwd = 0.25,
      col = "black",
      fill = NA
    )
  )


```

##### Mapping precipitation across Australia with glyphs

Building on the temperature analysis, this section maps precipitation across Australia using glyphs. Average rainfall is calculated for each region and visualized with geom_glyph_ribbon(). The glyphs are color-coded to show different rainfall levels. Reference lines and glyph boxes, similar to the previous section, enhance readability and provide a clear comparison of precipitation patterns across the country.

```{r}

prcp <- aus_temp |>
   group_by(id) |>
   mutate(prcp = mean(prcp, na.rm = TRUE)) |>
   ggplot(aes(x_major = long, y_major = lat, x_minor = month,
              ymin_minor = tmin, ymax_minor = tmax,
              fill = prcp, color = prcp)) +
  geom_sf(data = abs_ste, color = grey(0.7), fill = NA,
          inherit.aes = FALSE)  +
   add_glyph_boxes() +
   add_ref_lines() +
   geom_glyph_ribbon() +
   coord_sf(xlim = c(112,155)) +
  theme_map() +
  theme(legend.position.inside = c(.3,0), 
        legend.direction = "horizontal",
        panel.background = element_rect(fill = "white", color = NA),
        plot.background = element_rect(fill = "white", color = NA)) +
  scale_fill_gradientn(colors = c("#ADD8E6", "#2b5e82", "dodgerblue4")) +
  scale_color_gradientn(colors = c( "#ADD8E6", "#2b5e82", "dodgerblue4")) 
  

# Using gridExtra and grid packages to add neat line to the plot
grid.arrange(prcp, ncol = 1) 
grid.rect(
    width = 0.98,
    height = 0.98,
    gp = grid::gpar(
      lwd = 0.25,
      col = "black",
      fill = NA
    )
  )
```

##### Comparative visualization by factors across years

Say you want to compares temperature data across different years for selected regions in Victoria. Using geom_glyph_ribbon(), the visualization shows how temperatures have changed over time, with each year highlighted in different colors for easy comparison. Reference lines and glyph boxes help clarify the data, making it simple to spot trends and patterns across the years.

```{r}

fact <- historical_temp |>
  filter(id %in% c("ASN00026021", "ASN00085291", "ASN00084143")) |>
   ggplot(aes(color = factor(year), fill = factor(year), group = interaction(year,id),
              x_major = long, y_major = lat, x_minor = month, 
              ymin_minor = tmin, ymax_minor = tmax)) +
  geom_sf(data = abs_ste |> filter(NAME == "Victoria"),
           fill = NA, color = grey(0.7),
           inherit.aes = FALSE)  +
   add_glyph_boxes() +
   add_ref_lines() +
   geom_glyph_ribbon(alpha = 0.5) +
  labs(x = "Longitude", y = "Latitude",
       color = "year", fill = "year") +
  theme_map() +
  theme(legend.position.inside = c(.3,0.9), 
        legend.direction = "horizontal",
        panel.background = element_rect(fill = "white", color = NA),
        plot.background = element_rect(fill = "white", color = NA)) +
  scale_colour_wsj("colors6") +
  scale_fill_wsj("colors6") 


# Using gridExtra and grid packages to add neat line to the plot
grid.arrange(fact, ncol = 1) 
grid.rect(
    width = 0.98,
    height = 0.98,
    gp = grid::gpar(
      lwd = 0.25,
      col = "black",
      fill = NA
    )
  )
```

##### Integrating legends in map visualizations

The `add_geom_legend()` function enhances map visualizations by adding an enlarged version of one of the glyphs in the bottom left corner of the plot. This makes it easier to understand the symbols used in the map.

In this example, a map of Australia is created with geom_glyph_ribbon() to display temperature data. The legend is integrated directly into the plot using add_glyph_legend(), providing a clear reference for interpreting the glyphs without cluttering the map. This approach ensures that the visualization remains both informative and visually clean.

```{r}
legend <- aus_temp |>
   ggplot(aes(x_major = long, y_major = lat,
              x_minor = month, ymin_minor = tmin, ymax_minor = tmax)) +
  geom_sf(data = abs_ste ,
           fill = NA, color = grey(0.7),
           inherit.aes = FALSE)  +
  add_glyph_boxes() +
  add_ref_lines() +
  add_glyph_legend() + 
  geom_glyph_ribbon() + 
  theme(legend.position.inside = c(.3,0.9), 
        legend.direction = "horizontal",
        panel.background = element_rect(fill = "white", color = NA),
        plot.background = element_rect(fill = "white", color = NA)) +
  theme_map() 


# Using gridExtra and grid packages to add neat line to the plot
grid.arrange(legend, ncol = 1) 
grid.rect(
    width = 0.98,
    height = 0.98,
    gp = grid::gpar(
      lwd = 0.25,
      col = "black",
      fill = NA
    )
  )
```

#### GeomSegmentGlyph

```{r}

segment <- aus_temp |>
  filter(id %in% sample(id, 18)) |>
  ggplot(aes(x_major = long, y_major = lat, 
                      x_minor = month, y_minor = tmin, 
                      yend_minor = tmax)) +
  geom_sf(data = abs_ste ,
           fill = NA, color = grey(0.7),
           inherit.aes = FALSE)  +
  add_glyph_boxes(width = 4, height = 3) +
  add_ref_lines(width = 4, height = 3) +
  geom_glyph_segment(width = 4, height = 3) +
  add_glyph_legend() +
  coord_sf(xlim = c(110,155)) +
  theme_map()

# Using gridExtra and grid packages to add neat line to the plot
grid.arrange(segment, ncol = 1) 
grid.rect(
    width = 0.98,
    height = 0.98,
    gp = grid::gpar(
      lwd = 0.25,
      col = "black",
      fill = NA
    )
  )
  
```

```{r, eval=FALSE}
set.seed(32425)
historical_temp |>
  filter(id %in% sample(id, 10)) |>
  ggplot(aes(x_major = long, y_major = lat,  color = factor(year), group = interaction(year,id),
                      x_minor = month, y_minor = tmin, 
                      yend_minor = tmax)) +
  geom_sf(data = abs_ste |> filter(NAME == "Western Australia"),
           fill = NA, color = grey(0.7),
           inherit.aes = FALSE)  +
  add_glyph_boxes(width = 4, height = 3) +
  add_ref_lines(width = 4, height = 3) +
  geom_glyph_segment(width = 4, height = 3) +
  coord_sf(xlim = c(110,130), ylim = c(-40,-10)) +
  theme_map() +
  theme(legend.position.inside = c(.3,0.9), 
        legend.direction = "horizontal",
        panel.background = element_rect(fill = "white", color = NA),
        plot.background = element_rect(fill = "white", color = NA))
```



